<script setup lang="ts">
import VIcon from '@/components/v-icon/v-icon.vue';
import VTextOverflow from '@/components/v-text-overflow.vue';
import { breakpointsTailwind, useBreakpoints } from '@vueuse/core';
import { computed } from 'vue';
import { useNavBarStore } from '../stores/nav-bar';
import { useSidebarStore } from '../stores/sidebar';
import PrivateViewHeaderBarActions from './private-view-header-bar-actions.vue';
import PrivateViewHeaderBarIcon from './private-view-header-bar-icon.vue';

const navBarStore = useNavBarStore();
const sidebarStore = useSidebarStore();

const { sm } = useBreakpoints(breakpointsTailwind);

const props = defineProps<{
	title?: string,
	shadow: boolean,
	inlineNav: boolean,
	icon?: string,
	iconColor?: string,
	showBack?: boolean
}>();

const showNavToggle = computed(() => {
	if (props.inlineNav) {
		return navBarStore.collapsed;
	}

	return true;
});

const showSidebarToggle = computed(() => {
	return !sm.value;
});
</script>

<template>
	<header class="header-bar" :class="{shadow}">
		<VIcon v-if="showNavToggle" small class="nav-toggle" name="left_panel_open" clickable @click="navBarStore.expand" />

		<PrivateViewHeaderBarIcon v-if="icon || showBack" :icon :show-back :icon-color />

		<div class="title-outer-prepend">
			<slot name="title-outer:prepend" />
		</div>

		<div class="title-container">
			<div class="headline">
				<slot name="headline" />
			</div>

			<div class="title">
				<slot name="title">
					<slot name="title:prepend" />

					<h1 class="type-title">
						<VTextOverflow :text="title" placement="bottom">{{ title }}</VTextOverflow>
					</h1>

					<slot name="title:append" />
				</slot>
			</div>
		</div>

		<div class="title-outer-append">
			<slot name="title-outer:append" />
		</div>

		<div class="spacer" />

		<PrivateViewHeaderBarActions>
			<template #prepend><slot name="actions:prepend" /></template>
			<slot name="actions" />
			<template #append><slot name="actions:append" /></template>
		</PrivateViewHeaderBarActions>

		<VIcon v-if="showSidebarToggle" name="menu_open" clickable @click="sidebarStore.expand" />
	</header>
</template>

<style scoped>
.header-bar {
	position: sticky;
	inset-block-start: 0;
	z-index: 4;
	background-color: var(--theme--header--background);
	inline-size: 100%;
	block-size: calc(var(--header-bar-height) + var(--theme--header--border-width));
	/* TODO re-add border support themed */
	display: flex;
	align-items: center;
	gap: 12px;
	padding-inline: var(--content-padding);
	box-shadow: none;

	&.shadow {
		box-shadow: var(--theme--header--box-shadow);
		transition: box-shadow var(--fast) var(--transition);
	}
}

:is(.title-outer-prepend, .title-outer-append):empty {
	display: contents;
}

.title-container {
	position: relative;
	overflow: hidden;
}

.headline {
	--v-breadcrumb-color: var(--theme--header--headline--foreground);

	font-weight: 600;
	font-size: 12px;
	line-height: 12px;
	white-space: nowrap;
	font-family: var(--theme--header--headline--font-family);
}

.spacer {
	flex-basis: 0;
	flex-grow: 1;
}
</style>
