(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e6161a4"],{"2c47":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"interface-one-to-many"},[!1===e.relationSetup?i("div",{staticClass:"notice"},[i("p",[i("v-icon",{attrs:{name:"warning"}}),e._v("\n      "+e._s(e.$t("interfaces-one-to-many-relation_not_setup"))+"\n    ")],1)]):[e.items.length?i("div",{staticClass:"table"},[i("div",{staticClass:"header"},[i("div",{staticClass:"row"},e._l(e.columns,function(t){return i("button",{key:t.field,attrs:{type:"button"},on:{click:function(i){return e.changeSort(t.field)}}},[e._v("\n            "+e._s(t.name)+"\n            "),e.sort.field===t.field?i("v-icon",{attrs:{name:e.sort.asc?"arrow_downward":"arrow_upward",size:"16"}}):e._e()],1)}),0)]),i("div",{staticClass:"body"},e._l(e.items,function(t){return i("div",{key:t[e.relatedKey],staticClass:"row",on:{click:function(i){e.editExisting=t}}},[e._l(e.columns,function(e){return i("div",{key:e.field},[i("v-ext-display",{attrs:{"interface-type":(e.fieldInfo||{}).interface||null,name:e.field,type:e.fieldInfo.type,datatype:e.fieldInfo.datatype,options:e.fieldInfo.options,value:t[e.field]}})],1)}),i("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.$t("remove_related"),expression:"$t('remove_related')"}],staticClass:"remove-item",attrs:{type:"button"},on:{click:function(i){return i.stopPropagation(),e.removeRelated(t[e.relatedKey])}}},[i("v-icon",{attrs:{name:"close"}})],1)],2)}),0)]):e._e(),i("button",{staticClass:"style-btn select",attrs:{type:"button"},on:{click:function(t){e.addNew=!0}}},[i("v-icon",{attrs:{name:"add"}}),e._v("\n      "+e._s(e.$t("add_new"))+"\n    ")],1),i("button",{staticClass:"style-btn select",attrs:{type:"button"},on:{click:function(t){e.selectExisting=!0}}},[i("v-icon",{attrs:{name:"playlist_add"}}),i("span",[e._v(e._s(e.$t("select_existing")))])],1)],e.selectExisting?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{title:e.$t("select_existing"),buttons:{save:{text:"Save",color:"accent",loading:e.selectionSaving}},"action-required":""},on:{close:e.dismissSelection,save:e.saveSelection}},[i("div",{staticClass:"search"},[i("v-input",{staticClass:"search-input",attrs:{type:"search",placeholder:e.$t("search")},on:{input:e.onSearchInput}})],1),i("v-items",{staticClass:"items",attrs:{collection:e.relatedCollection,filters:e.filters,"view-query":e.viewQuery,"view-type":e.viewType,"view-options":e.viewOptions,selection:e.selection},on:{options:e.setViewOptions,query:e.setViewQuery,select:function(t){e.selection=t}}})],1)],1):e._e(),e.editExisting?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{title:e.$t("editing_item"),buttons:{save:{text:"Save",color:"accent",loading:e.selectionSaving}}},on:{close:function(t){e.editExisting=!1},save:e.saveEdits}},[i("div",{staticClass:"edit-modal-body"},[i("v-form",{attrs:{fields:e.relatedCollectionFields,values:e.editExisting},on:{"stage-value":e.stageValue}})],1)])],1):e._e(),e.addNew?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{title:e.$t("creating_item"),buttons:{save:{text:"Save",color:"accent",loading:e.selectionSaving}}},on:{close:function(t){e.addNew=null},save:e.addNewItem}},[i("div",{staticClass:"edit-modal-body"},[i("v-form",{attrs:{"new-item":"",fields:e.relatedCollectionFields,values:e.relatedDefaultsWithEdits},on:{"stage-value":e.stageValue}})],1)])],1):e._e()],2)},s=[],l=i("7618"),r=(i("ac6a"),i("bd86")),a=(i("6762"),i("2fdb"),i("75fc")),o=i("cebc"),c=(i("55dd"),i("28a5"),i("a745")),u=i.n(c),d=(i("7514"),i("8db2")),f=i.n(d),p={mixins:[f.a],name:"interface-one-to-many",data:function(){return{sort:{field:null,asc:!0},selectExisting:!1,selectionSaving:!1,selection:[],editExisting:null,addNew:null,edits:{},viewOptionsOverride:{},viewTypeOverride:null,viewQueryOverride:{},filtersOverride:[]}},computed:{relationSetup:function(){return!!this.relation},currentCollection:function(){return this.relation.collection_one.collection},relatedCollection:function(){return this.relation.collection_many.collection},relatedCollectionFields:function(){return this.relation.collection_many.fields},relatedKey:function(){return _.find(this.relation.collection_many.fields,{primary_key:!0}).field},relatedField:function(){return this.relation.field_many.field},visibleFields:function(){return!1===this.relationSetup?[]:this.options.fields?u()(this.options.fields)?this.options.fields.map(function(e){return e.trim()}):this.options.fields.split(",").map(function(e){return e.trim()}):[]},items:function(){var e=this;return!1===this.relationSetup?[]:_.orderBy((this.value||[]).filter(function(e){return!e.$delete}),function(t){return t[e.sort.field]},this.sort.asc?"asc":"desc")},columns:function(){var e=this;return!1===this.relationSetup?null:this.visibleFields.map(function(t){return{field:t,name:e.$helpers.formatTitle(t),fieldInfo:e.relatedCollectionFields[t]}})},relatedDefaultValues:function(){return!1===this.relationSetup?null:this.relatedCollectionFields?_.mapValues(this.relatedCollectionFields,function(e){return e.default_value}):null},relatedDefaultsWithEdits:function(){return!1===this.relationSetup?null:this.relatedDefaultValues?Object(o["a"])({},this.relatedDefaultValues,this.edits):null},filters:function(){return!1===this.relationSetup?null:[].concat(Object(a["a"])(this.options.preferences&&this.options.preferences.filters||[]),Object(a["a"])(this.filtersOverride))},viewOptions:function(){if(!1===this.relationSetup)return null;var e=this.options.preferences&&this.options.preferences.viewOptions||{};return Object(o["a"])({},e,this.viewOptionsOverride)},viewType:function(){return!1===this.relationSetup?null:this.viewTypeOverride?this.viewTypeOverride:this.options.preferences&&this.options.preferences.viewType||"tabular"},viewQuery:function(){if(!1===this.relationSetup)return null;var e=this.options.preferences&&this.options.preferences.viewQuery||{};return Object(o["a"])({},e,this.viewQueryOverride)}},created:function(){this.relationSetup&&(this.sort.field=this.visibleFields&&this.visibleFields[0],this.setSelection()),this.onSearchInput=_.debounce(this.onSearchInput,200)},watch:{value:function(){this.setSelection()},relation:function(){this.relationSetup&&(this.sort.field=this.visibleFields&&this.visibleFields[0],this.setSelection())}},methods:{setViewOptions:function(e){this.viewOptionsOverride=Object(o["a"])({},this.viewOptionsOverride,e)},setViewQuery:function(e){this.viewQueryOverride=Object(o["a"])({},this.viewQueryOverride,e)},setSelection:function(){this.value&&(this.selection=this.value.filter(function(e){return!e.$delete}))},changeSort:function(e){this.sort.field!==e?(this.sort.asc=!0,this.sort.field=e):this.sort.asc=!this.sort.asc},saveSelection:function(){var e=this;this.selectionSaving=!0;var t=(this.value||[]).filter(function(e){return!e.$delete}).map(function(t){return t[e.relatedKey]}),i=this.selection.map(function(t){return t[e.relatedKey]}),n=(this.value||[]).map(function(t){var n,s=t[e.relatedKey];if(!s)return t;if(!1===i.includes(s))return n={},Object(r["a"])(n,e.relatedKey,t[e.relatedKey]),Object(r["a"])(n,"$delete",!0),n;if(t.$delete&&i.includes(s)){var l=Object(o["a"])({},t);return delete l.$delete,l}return t});i.forEach(function(i,s){if(!1===t.includes(i)){var l=Object(o["a"])({},e.selection[s]);delete l[e.relation.field_many.field],n.push(l)}}),n=n.map(function(t){return"object"===Object(l["a"])(t)&&t.hasOwnProperty(e.relatedField)&&delete t[e.relatedField],t}),this.$emit("input",n),this.selectExisting=!1,this.selectionSaving=!1},dismissSelection:function(){this.setSelection(),this.selectExisting=!1},stageValue:function(e){var t=e.field,i=e.value;this.$set(this.edits,t,i)},saveEdits:function(){var e=this;this.$emit("input",Object(a["a"])((this.value||[]).map(function(t){return t.id===e.editExisting[e.relatedKey]?Object(o["a"])({},t,e.edits):t}).map(function(t){return"object"===Object(l["a"])(t)&&t.hasOwnProperty(e.relatedField)&&delete t[e.relatedField],t}))),this.edits={},this.editExisting=!1},addNewItem:function(){var e=this;this.$emit("input",[].concat(Object(a["a"])((this.value||[]).map(function(t){return"object"===Object(l["a"])(t)&&t.hasOwnProperty(e.relatedField)&&delete t[e.relatedField],t})),[this.edits])),this.edits={},this.addNew=!1},removeRelated:function(e){var t=this;e?this.$emit("input",(this.value||[]).map(function(i){var n;return i[t.relatedKey]===e?(n={},Object(r["a"])(n,t.relatedKey,i[t.relatedKey]),Object(r["a"])(n,"$delete",!0),n):i}).map(function(e){return"object"===Object(l["a"])(e)&&e.hasOwnProperty(t.relatedField)&&delete e[t.relatedField],e})):this.$emit("input",(this.value||[]).filter(function(i){return i[t.relatedKey]!==e}).map(function(e){return"object"===Object(l["a"])(e)&&e.hasOwnProperty(t.relatedField)&&delete e[t.relatedField],e}))},onSearchInput:function(e){this.setViewQuery({q:e})}}},v=p,h=(i("a14f"),i("2877")),y=Object(h["a"])(v,n,s,!1,null,"0ac7ce1b",null);t["default"]=y.exports},"8db2":function(e,t){e.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null}}}},"9c42":function(e,t,i){},a14f:function(e,t,i){"use strict";var n=i("9c42"),s=i.n(n);s.a}}]);
//# sourceMappingURL=chunk-5e6161a4.7bf57972.js.map