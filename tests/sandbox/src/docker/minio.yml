services:
  minio:
    # should stay compatible via S3 driver
    image: minio/minio
    command: server /data/minio/ --console-address :9001
    ports:
      - ${MINIO_PORT}:9000
      - 8882:9001
    environment:
      MINIO_ROOT_USER: directus
      MINIO_ROOT_PASSWORD: miniosecret

  minio-mc:
    image: minio/mc
    depends_on:
      - minio
    entrypoint: >
      /bin/sh -c " until (/usr/bin/mc alias set directusminio http://minio:9000 directus miniosecret &&
             /usr/bin/mc admin info directusminio > /dev/null 2>&1); do
          echo 'Waiting for MinIO to be ready...';
          sleep 1;
      done; /usr/bin/mc mb directusminio/directus-blackbox-test; while true; do
          sleep 3600;
      done;"
